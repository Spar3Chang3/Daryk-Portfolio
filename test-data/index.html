<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>

	<script type="module">
		function convertGifsToBmps(files) {
			for (const file of files) {
				if (!file.type.startsWith("image/gif")) continue;

				const reader = new FileReader();
				reader.onload = function (e) {
					const img = new Image();
					img.onload = function () {
						const canvas = document.createElement("canvas");
						canvas.width = img.width;
						canvas.height = img.height;

						const ctx = canvas.getContext("2d");
						ctx.drawImage(img, 0, 0);

						// Extract raw pixel data (BMP requires ARGB pixel data)
						const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
						const bmpBlob = createBMPBlob(imageData);

						// Trigger download
						const a = document.createElement("a");
						a.href = URL.createObjectURL(bmpBlob);
						a.download = file.name.replace(/\.gif$/i, ".bmp");
						document.body.appendChild(a);
						a.click();
						document.body.removeChild(a);
					};
					img.src = e.target.result;
				};
				reader.readAsDataURL(file);
			}
		}

		function createBMPBlob(imageData) {
			const w = imageData.width;
			const h = imageData.height;
			const rowSize = Math.ceil(w * 3 / 4) * 4;
			const imageSize = rowSize * h;
			const fileSize = 54 + imageSize;

			const buffer = new ArrayBuffer(fileSize);
			const view = new DataView(buffer);

			let offset = 0;

			// Bitmap file header (14 bytes)
			view.setUint8(offset++, 0x42); // B
			view.setUint8(offset++, 0x4D); // M
			view.setUint32(offset, fileSize, true); offset += 4;
			view.setUint32(offset, 0, true); offset += 4;
			view.setUint32(offset, 54, true); offset += 4; // Pixel data offset

			// DIB header (40 bytes)
			view.setUint32(offset, 40, true); offset += 4;
			view.setInt32(offset, w, true); offset += 4;
			view.setInt32(offset, -h, true); offset += 4; // negative height = top-down
			view.setUint16(offset, 1, true); offset += 2; // planes
			view.setUint16(offset, 24, true); offset += 2; // bits per pixel
			view.setUint32(offset, 0, true); offset += 4; // compression
			view.setUint32(offset, imageSize, true); offset += 4;
			view.setInt32(offset, 2835, true); offset += 4; // x pixels per meter (72 DPI)
			view.setInt32(offset, 2835, true); offset += 4;
			view.setUint32(offset, 0, true); offset += 4;
			view.setUint32(offset, 0, true); offset += 4;

			// Pixel array (bottom-up)
			const data = imageData.data;
			let pad = rowSize - w * 3;
			for (let y = 0; y < h; y++) {
				for (let x = 0; x < w; x++) {
					const i = (y * w + x) * 4;
					view.setUint8(offset++, data[i + 2]); // R
					view.setUint8(offset++, data[i + 1]); // G
					view.setUint8(offset++, data[i]);     // B
				}
				offset += pad;
			}

			return new Blob([buffer], { type: "image/bmp" });
		}


	</script>
</head>
<body>
<input type="file" multiple accept="image/gif" onchange="window.convertGifsToBmps(this.files)">
</body>
</html>